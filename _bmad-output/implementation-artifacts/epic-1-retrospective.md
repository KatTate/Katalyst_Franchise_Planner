# Epic 1 Retrospective: Auth, Onboarding & User Management

**Date:** 2026-02-09
**Facilitator:** Bob (Scrum Master)
**Epic Status:** Done (6/6 stories)
**Participants:** User (Project Lead), Bob (SM), Alice (PO), Charlie (Senior Dev), Dana (QA), Elena (Junior Dev)

---

## Part 1: Epic Review

### Delivery Metrics

| Metric | Value |
|--------|-------|
| Stories completed | 6/6 (100%) |
| Total commits | 97 |
| Descriptive commit messages | 87 (90%) |
| Generic/auto-generated commit messages | 10 (10%) |
| Sprint change proposals | 1 (Google OAuth pivot) |
| Agent model | Claude 4.6 Opus (Replit Agent) |

### Codebase Vital Signs (LSP Diagnostics)

**Status: CLEAN** - Zero type errors, zero unused imports, zero unresolved references across the entire codebase.

### Tech Debt Markers Scan

**Status: CLEAN** - Zero TODO, FIXME, HACK, WORKAROUND, or TEMP markers found in any source file (.ts, .tsx, .js, .jsx).

### File Churn Analysis (Source Code)

Files modified most frequently across 97 commits — high churn can indicate instability, rework, or a file taking on too many responsibilities:

| File | Modifications | Assessment |
|------|--------------|------------|
| server/routes.ts | 9 | High churn — expected as every story added endpoints, but also suggests this file may need modularization |
| server/storage.ts | 7 | Expected — storage interface grew with each story |
| client/src/App.tsx | 5 | Expected — routing, guards, and layout evolved across stories |
| shared/schema.ts | 4 | Expected — schema evolved as features were added |
| server/auth.ts | 3 | Normal — auth strategies were added incrementally |
| client/src/pages/login.tsx | 3 | Normal — login page evolved from OAuth-only to dual auth |
| server/seed.ts | 2 | Created then likely modified — minor |
| client/src/pages/dashboard.tsx | 2 | Normal |
| client/src/components/app-sidebar.tsx | 2 | Normal — role-based nav added in Story 1.5 |

**Notable:** `server/routes.ts` with 9 modifications is the highest-churn source file. As more epics add routes, this file will become unwieldy. Route modularization should be considered.

### Live UI Verification (Screenshots)

All key screens were verified via live browser testing:

- **Login page:** Renders correctly with both Dev Login bypass and email/password form. Proper styling and layout.
- **Dashboard:** Loads after successful login. Sidebar visible with role-appropriate navigation.
- **Admin Invitations page:** Form with email, role selector, and brand selector renders correctly. Invitations table visible.
- **Logout flow:** Confirmation dialog appears, logout redirects to login page.
- **Verdict:** All Epic 1 UI deliverables are functional and visually correct.

### Commit History Patterns

- **97 total commits** across the epic
- **10 generic "Saved progress at the end of the loop" commits** — these are auto-generated by the Replit checkpoint system and carry no meaningful context. Not a code quality issue, but they dilute the commit history.
- **No fix-after-fix patterns detected** — no commits with messages containing "fix", "revert", "undo", or "broken", which suggests features were implemented correctly on first attempt or fixes were bundled into the same commit (harder to trace).
- **Highest-churn files** align with expected architectural patterns — routes, storage, and app layout were legitimately modified across most stories.

---

## Part 2: What Went Well

1. **Dual authentication architecture is sound.** Google OAuth for Katalyst admins + invitation-based email/password for franchisees cleanly separates concerns. The Sprint Change Proposal to pivot from custom auth to Google OAuth was the right call.

2. **RBAC middleware extraction (Story 1.5)** created reusable `requireAuth()`, `requireRole()`, `scopeToUser()` patterns in dedicated middleware files. Clean foundation for all future epics.

3. **Storage abstraction pattern** (`IStorage` interface) kept all database operations centralized from day one. Every story extended the same interface.

4. **Codebase health is excellent.** Zero LSP errors, zero tech debt markers, clean type safety across the entire project.

5. **Security was consistently prioritized.** bcrypt cost 12, timing-safe comparisons, 404 over 403 for unauthorized access, domain restriction on Google OAuth.

6. **UI delivered and verified.** All screens render correctly with proper styling, role-based navigation, and functional flows.

---

## Part 3: What Didn't Go Well

**User (Project Lead) assessment: "Hot mess express."**

1. **Agent repeatedly failed to follow BMad workflows.** This was the dominant issue. The agent would skip workflow steps, not update story statuses to "in-progress", not fill Dev Agent Records at completion, and at one point created Story 1.3 before the SM had run the create-story workflow. The lesson "follow the BMad workflow" was ironically written in a retrospective that itself didn't follow the BMad retrospective workflow.

2. **Major course correction required mid-epic.** Two significant issues required rework:
   - Pivoting from custom auth to Google OAuth (addressed via Sprint Change Proposal)
   - Original epics and stories lacked UI acceptance criteria. Multiple stories were built backend-only before this was caught, requiring rewrites of epics and stories.

3. **Story sequencing violated.** The agent jumped ahead to implement stories before the SM had properly prepared them via the create-story workflow, bypassing the preparation step that ensures stories have complete context, proper acceptance criteria, and UI specifications.

4. **Retrospective workflow itself was botched on first attempt.** The agent wrote a quick summary document instead of adopting the SM persona and following the 10-step interactive retrospective workflow — while listing "follow the workflow" as a lesson learned.

---

## Part 4: Action Items

| # | Action Item | Owner | Priority |
|---|------------|-------|----------|
| 1 | **Agent MUST follow BMad workflows exactly as written.** No shortcuts, no skipping steps, no "I'll fill in the Dev Agent Record later." Read the workflow file, execute each step in order. | Dev Agent | Critical |
| 2 | **Never create or implement a story without running the create-story workflow first.** The SM prepares stories for a reason — to ensure proper context, UI criteria, and acceptance criteria exist before implementation begins. | Dev Agent / SM | Critical |
| 3 | **Always adopt the correct agent persona for the task.** Retrospective = SM (Bob). Story creation = SM (Bob). Implementation = Dev (Amelia). Don't blur the lines. | All Agents | High |
| 4 | **Consider modularizing server/routes.ts.** With 9 modifications across 6 stories and more epics coming, this file will become a bottleneck. Consider splitting routes by domain (auth routes, invitation routes, brand routes, etc.). | Dev Agent | Medium |
| 5 | **Add git diff review to retrospective process.** The current BMad retrospective workflow doesn't include a formal git review step. Commit history, file churn, and fix-after-fix patterns should be standard retrospective evidence. | SM | Medium |
| 6 | **Add unit tests for critical middleware** before building more routes on top of them. `requireAuth`, `requireRole`, `scopeToUser` need test coverage to catch regressions. | Dev Agent | Medium |

---

## Part 5: Technical Debt Register

| # | Debt Item | Source | Severity | Target |
|---|----------|--------|----------|--------|
| 1 | RBAC Layer 3 (response-level projection / field filtering) designed but not implemented | Story 1.5 | Low (until Epic 8) | Epic 8 |
| 2 | No automated unit tests for middleware or storage operations | All stories | Medium | Epic 2 |
| 3 | Session cleanup (expired session pruning) not configured for production | Story 1.4 | Low (until deployment) | Pre-deployment |
| 4 | `server/routes.ts` accumulating all routes in single file (9 modifications, growing) | All stories | Low (becoming Medium) | Epic 2-3 |

---

## Part 6: Next Epic Preparation (Epic 2: Brand Configuration & Administration)

### Overview
5 stories covering brand entity creation, startup cost templates, brand identity/theming, account manager assignment, and configuration validation.

### Dependencies on Epic 1
- Auth system (Google OAuth for Katalyst admins) — needed for all admin routes
- RBAC middleware (`requireAuth`, `requireRole("katalyst_admin")`) — gates all brand admin endpoints
- `brands` and `users` tables — foundation for brand configuration
- Storage abstraction pattern — will extend `IStorage` with brand management operations

### Preparation Checklist
- [ ] Run create-story workflow for Story 2.1 before implementation begins
- [ ] Ensure UI acceptance criteria are included in every story from the start
- [ ] Follow BMad workflow steps precisely — status updates, Dev Agent Records, proper agent personas
- [ ] Consider route modularization before adding more endpoints to `server/routes.ts`

---

## Retrospective Meta-Notes

This retrospective was initially run incorrectly (agent wrote a summary doc without following the workflow or adopting the SM persona). It was restarted and run properly as Bob the SM using the Party Mode format from the BMad retrospective workflow, with four additional data sources incorporated per the Project Lead's direction:

1. **Git Commit History** — 97 commits analyzed for churn, fix patterns, and message quality
2. **LSP Diagnostics Scan** — Full codebase health check (result: clean)
3. **Codebase-Wide Pattern Search** — TODO/FIXME/HACK marker scan (result: clean)
4. **Live Screenshot Verification** — All key UI screens verified via automated browser testing

These four tools should be standard practice for all future retrospectives.

---

**Retrospective facilitated by:** Bob (Scrum Master)
**Date:** 2026-02-09
