# generated: 2026-02-09
# updated: 2026-02-20 (Story 10.2 context document created: Multi-Chart Sensitivity Dashboard)
# project: Katalyst Growth Planner
# project_key: NOKEY
# tracking_system: file-system
# story_location: _bmad-output/implementation-artifacts

# STATUS DEFINITIONS:
# ==================
# Epic Status:
#   - backlog: Epic not yet started
#   - in-progress: Epic actively being worked on
#   - done: All stories in epic completed
#
# Epic Status Transitions:
#   - backlog → in-progress: Automatically when first story is created (via create-story)
#   - in-progress → done: Manually when all stories reach 'done' status
#
# Story Status:
#   - backlog: Story only exists in epic file
#   - ready-for-dev: Story file created in stories folder
#   - in-progress: Developer actively working on implementation
#   - review: Ready for code review (via Dev's code-review workflow)
#   - done: Story completed
#
# Retrospective Status:
#   - optional: Can be completed but not required
#   - done: Retrospective has been completed
#
# WORKFLOW NOTES:
# ===============
# - Epic transitions to 'in-progress' automatically when first story is created
# - Stories can be worked in parallel if team capacity allows
# - SM typically creates next story after previous one is 'done' to incorporate learnings
# - Dev moves story to 'review', then runs code-review (fresh context, different LLM recommended)

generated: 2026-02-09
updated: 2026-02-21  # Story 7.1 split into 7.1a-7.1d per Party Mode review
updated: 2026-02-21  # Story 7.1 context document created (Create Story workflow)
updated: 2026-02-21  # Story 5H.4 context document created (Create Story workflow)
updated: 2026-02-21  # SCP-2026-02-21 approved: Epic 10 pivot to user-authored scenario modeling
updated: 2026-02-21  # Story 5H.2 → done (adversarial code review completed, all findings fixed)
updated: 2026-02-20  # Story 10.2 context document created (Create Story workflow)
updated: 2026-02-20  # Story 5H.2 → review (dev-story workflow complete, pending code review)
updated: 2026-02-21  # Story 5H.3 context document created (Create Story workflow)
project: Katalyst Growth Planner
project_key: NOKEY
tracking_system: file-system
story_location: _bmad-output/implementation-artifacts

# CHANGE LOG:
# ===========
# 2026-02-21: SCP-2026-02-21 approved — Epic 10 pivot to user-authored scenario modeling
#   - Conservative/Optimistic system-defined columns KILLED (D1)
#   - Replaced with Base Case vs Your Scenario (user's live slider state) (D2/D3)
#   - Slider ranges widened: ±50%/±100% visual range, uncapped numeric input (D6)
#   - Story 10.2 split → 10-2a (Chart Dashboard) + 10-2b (Metric Delta Cards)
#   - Story 10.3 promoted from optional to essential (Scenario Persistence & Comparison)
#   - sensitivity-engine.ts simplified: 4→2 engine calls (CP-7)
#   - what-if-playground.tsx updated: Reset button, 2-column metric layout (CP-8)
#   - All 8 change proposals (CP-1 through CP-8) applied to artifacts and code
#   - See: sprint-change-proposal-2026-02-21.md
# 2026-02-15: Sprint Change Proposal approved — Financial Statement Output Layer
#   - New Epic 5: Financial Statement Views & Output Layer (10 stories)
#   - New Epic 6: Document Generation & Vault (2 stories, elevated from old Epic 7)
#   - New Epic 7: Per-Year Inputs & Multi-Plan Management (2 stories)
#   - Old Epic 5 (Advisory Guardrails) renumbered to Epic 8
#   - Old Epic 6 (AI Planning Advisor) renumbered to Epic 9
#   - Old Epic 7 (Scenario & Docs) split: PDF→Epic 6, Scenario→Epic 10
#   - Old Epic 8 (Data Sharing) renumbered to Epic 11
#   - Old Epic 9 (Advisory Board) renumbered to Epic 12
#   - Pre-implementation: resolve carried tech debt (CP-8)
#   - See: sprint-change-proposal-2026-02-15.md
# 2026-02-16: Correct Course handoff actions completed
#   - PRD updated with FR7a-FR7n (14 new functional requirements)
#   - epics.md restructured: new Epics 5-7, renumbered 8-12, Epic 5/7 story placeholders
#   - architecture.md updated: brand_account_managers table, engine extension design,
#     financial statement API endpoints, help content data model
#   - CP-8 tech debt: invitations.ts as-any replaced with typed InsertUser cast;
#     storage.ts as-any retained (drizzle-zod type compatibility — documented)
#   - UX design authority created: ux-financial-statements-spec.md (1,067 lines)
# 2026-02-16: Sprint Planning regenerated
#   - Epic 5 story keys corrected to match epics.md story titles
#     (was: 5-1-pl-statement-view etc.; now: 5-1-financial-engine-extension etc.)
#   - All story counts verified: 52 stories across 13 epics
#   - All statuses preserved — no downgrades
# 2026-02-16: Story 5.1 adversarial code review completed
#   - 0 HIGH, 3 MEDIUM, 3 LOW findings — all resolved
#   - Math.max(0) guard added for adjustedTotalWages, docstrings updated
#   - architecture.md synced (cfOtherAssetsChange → cfDepreciation)
#   - 173 tests passing (49 existing + 124 new), zero regressions
#   - Story status confirmed: done
# 2026-02-17: Story 5.2 adversarial code review completed
#   - 2 HIGH, 3 MEDIUM, 2 LOW findings — all resolved
#   - H1/H2: getQuarterlyValue percentage averaging fix (was summing → 3x values)
#   - M1: ExperienceTier type moved out of retired mode-switcher.tsx
#   - L1: hover:bg-muted/30 → hover-elevate; L2: as-any cast → EnrichedAnnualSummary type
#   - M2/M3: analysis-only (sub-sections and ColumnHeaders are intentional design)
#   - LSP clean, story status: done
# 2026-02-17: Story 5.3 adversarial code review completed
#   - 0 HIGH, 3 MEDIUM, 3 LOW findings — all resolved
#   - M1: Math.abs() added for expense row display (Dev Notes sign convention)
#   - M2: Section header sticky removed (z-index conflict with callout bar)
#   - M3: Section header keyboard accessibility (tabIndex, aria-expanded, onKeyDown)
#   - L1: EBITDA tooltip formula corrected; L2: dead code removed; L3: glossary link placeholder
#   - LSP clean, story status: done
# 2026-02-18: Story 5.4 completed (commit 99531198)
#   - Balance Sheet tab: verified and fixed cumulative depreciation calculation
#   - Cash Flow tab: new component with 4 sections, identity check, amber negative cash
#   - Container: BalanceSheetTab and CashFlowTab replace PlaceholderTab components
#   - 20/20 acceptance criteria verified against code, LSP clean
#   - Story status: done
# 2026-02-18: UX Design Specification consolidated
#   - Created ux-design-specification-consolidated.md as single source of truth
#   - Replaces ux-financial-statements-spec.md as UX design authority for all epics
#   - Establishes two-surface architecture (My Plan + Reports), retires three-mode model
#   - See: ux-design-specification-consolidated.md
# 2026-02-19: Story 5.5 adversarial code review completed
#   - 3 HIGH, 4 MEDIUM, 3 LOW findings — documented as review notes (not fixed)
#   - H1: Audit category names/count don't match AC14's 13 listed categories (engine produces 15)
#   - H2: Passing audit categories missing muted text styling (AC16)
#   - H3: Failing check detail missing per-row pass/fail icon (AC17)
#   - M1: tooltip.tsx modified (Dev Notes violation); M2: 6 undocumented file changes
#   - M3: Comparison mode missing keyboard accessibility; M4: unused useMemo import
#   - User chose option 2 (add review notes to story) — findings documented for dev agent
#   - Story status: in-progress (HIGH issues unresolved)
# 2026-02-18: Story 5.6 implementation completed (commit 4385698f, 6e33a51a)
#   - P&L inline editing: 5 editable rows (monthly-revenue, cogs-pct, dl-pct, marketing, other-opex)
#   - InlineEditableCell component: click-to-edit, Tab/Shift+Tab/Enter/Escape, flash animation
#   - Linked columns: all year columns update simultaneously with 200ms flash feedback
#   - Optimistic display: raw input values shown immediately from plan cache
#   - Double-commit guard (committedRef) prevents blur+Tab duplicate saves
#   - AC7 (EBITDA Multiple) deferred: ebitdaMultiple not in PlanFinancialInputs schema
#   - Playwright e2e tests passing, LSP clean
#   - Story status: review
# 2026-02-19: Sprint Change Proposal — UX Specification Compliance Remediation
#   - 13 divergences cataloged (3 Critical, 4 High, 4 Medium, 2 Low)
#   - 11 change proposals (CP-1 through CP-11) with execution sequence
#   - Adversarial review: 14 findings (2 CRITICAL, 4 HIGH, 4 MEDIUM, 2 LOW)
#   - Amendment A: Spec reconciliation — C1 reclassified as Category B (deprecate, don't delete)
#   - Amendment B: C-ratio display bug confirmed, formatted-output audit
#   - Selected approach: Option 1 (Direct Adjustment — patch forward)
#   - All divergences are UI-layer; engine/auth/API untouched
#   - See: sprint-change-proposal-2026-02-19.md
# 2026-02-20: PRD alignment edit completed
#   - PRD updated to align with two-surface UX architecture
#   - 24 new FRs added (FR74-FR97) covering Reports inline editing, two-surface model,
#     Impact Strip, Guardian Bar, Document Preview, plan completeness, glossary,
#     contextual help, behavioral tiers, and progressive disclosure
#   - FR12 rewritten: "two interaction surfaces" replaces "three experience tiers"
#   - Total PRD FRs: 111 (was 87)
# 2026-02-20: Implementation Readiness (IR) check completed
#   - 111 FRs traced, 30 NFRs validated, all substantively covered in story ACs
#   - 5 issues found: architecture.md still references "three modes" and retired components,
#     epics FR Coverage Map stale (claims 87/87, PRD has 111), environment gaps
#   - Overall status: NEEDS WORK (architecture doc + epics coverage map + remediation CPs)
#   - See: implementation-readiness-report-2026-02-20.md
# 2026-02-20: Sprint Planning regenerated
#   - Updated changelog with UX consolidation, SCP-2026-02-19, PRD edit, IR check
#   - All story counts verified: 52 stories across 13 epics (unchanged)
#   - All statuses preserved — no downgrades
#   - Next action: execute SCP-2026-02-19 remediation CPs to close Epic 5
# 2026-02-20: CP-6 executed — Story 5.5 HIGH findings resolved
#   - H1: Engine comment corrected (13→15 categories); CATEGORY_CONFIG verified correct (all 15 mapped)
#   - H2: Passing audit category labels now use text-muted-foreground (AC16 compliance)
#   - H3: Per-row pass/fail icons confirmed already present in AuditCheckRow component
#   - M4: useMemo import verified as used (finding was incorrect)
#   - Story 5.5 status: done
# 2026-02-20: CP-7 executed — Stories 5.6, 5.7, 5.8, 5.9, 5.10 re-verified
#   - Story 5.6 (My Plan + Impact Strip + Bidirectional Data Flow): PASS
#     InputPanel→FormsMode direct render (mode switcher removed per CP-1),
#     Impact Strip: sticky bottom bar, context-sensitive metrics, 3s delta fade,
#     guardian dots, deep links, doc preview icon, bidirectional P&L inline editing
#   - Story 5.7 (Scenario Comparison): RETIRED per Decision D6 in SCP-2026-02-20
#     ScenarioBar component retained; story scope moves to Epic 10 (What-If Playground)
#   - Story 5.8 (Guardian Bar & Dynamic Interpretation): PASS
#     3-level indicator system (healthy/attention/concerning), pulse animation on threshold
#     change, tab navigation on click, all-defaults note, sr-only accessibility text
#   - Story 5.9 (Document Preview & PDF Generation Trigger): PASS
#     Dashboard widget + modal preview, DRAFT watermark, PDF toast placeholder,
#     evolving button label (Generate Draft / Generate Package / Generate Lender Package),
#     Impact Strip doc preview icon, all-defaults note
#     Draft watermark threshold corrected: was <90%, now <50% per AC
#   - Story 5.10 (Glossary & Contextual Help): PASS
#     Searchable glossary page at /glossary/:slug, field help icons with tooltips,
#     expanded guidance, glossary cross-links, brand benchmarks, "See it in your plan",
#     sidebar navigation link
# 2026-02-20: SCP-2026-02-20 handoff — Correct Course Step 6 execution
#   - Codebase audit: 15/16 CPs confirmed done. Only CP-11 (border radius) incomplete.
#   - Document remediation executed (previously skipped during handoff):
#     a) architecture.md: FR count updated 87→96, 5 new FR categories added
#     b) epics.md: FR Coverage Map updated 87→96 (27 new FR mappings: FR74-FR97)
#     c) epics.md: Epic 10 rewritten — Story 10.1 decomposed into 3 stories
#        (10.1 Sensitivity Controls, 10.2 Multi-Chart Dashboard, 10.3 Scenario Persistence)
#        matching SCP Section 3 What-If Playground vision
#     d) epics.md: Quick Entry references updated (Epic 4 deprecation note, Epic 9 graceful
#        degradation, Story 8.1 advisory nudge) to reflect two-surface architecture
#     e) Epic 4 renamed: "Forms & Quick Entry Experience" → "Forms Experience & Planning Infrastructure"
#     f) Epic 5 FR coverage expanded to include FR84-FR97, story count corrected to 9
#   - Sprint status updated: Epic 10 stories reflect new 3-story structure
#   - CP-11 border radius polish: audit confirmed already applied (Card=rounded-2xl,
#     Button=rounded-xl, Input=rounded-xl). All 16/16 SCP items complete.
#   - Epic 5 marked DONE — all 9 stories + all SCP remediation CPs confirmed complete
# 2026-02-20: Epic 5 Retrospective — DRAFT (un-finalized)
#   - Product Owner assessment: "Dumpster fire shit show rodeo"
#   - Readiness assessment: RED (4 RED items: engine accuracy, code review, UI quality, agent control)
#   - 10 action items documented (3 CRITICAL, 3 HIGH, 3 MEDIUM, 1 carried)
#   - CRITICAL blocker: Financial engine never validated cell-by-cell against reference spreadsheets
#   - CRITICAL blocker: Code review coverage collapsed to 44%; no story has post-remediation review
#   - CRITICAL blocker: UI layout issues visible in Balance Sheet, sidebar overlap, comparison mode
#   - Agent control finding: Rogue agent approved own SCP amendments; process gap documented
#   - Draft status: Pending engine validation results before finalization
#   - See: epic-5-retrospective.md
# 2026-02-20: Sprint Planning regenerated (post-Create Epics workflow)
#   - Epic 5H: 4 stories formally created via full Create Epics 4-step workflow
#   - Party Mode review completed: 9 amendments applied to story ACs
#     (PO gates, prerequisite dependencies, Playwright verification, scope boundaries)
#   - All story counts verified: 57 stories across 14 epics
#   - 2 documented orphans preserved (4-7, 5-cp11) — historical implementation artifacts
#   - All statuses preserved — no downgrades
#   - Next action: Create Story (CS) for 5H.1 to begin hardening sprint
# 2026-02-20: Story 5H.1 context document created (Create Story workflow)
#   - Full story file: 5h-1-financial-engine-reference-validation.md (ready-for-dev)
#   - 21 acceptance criteria across 5 phases (Input Mapping, Cell Comparison,
#     Tolerance/Classification, Codify Tests, taxRate Resolution)
#   - Dev notes include: unwrapForEngine pipeline analysis, spreadsheet parsing
#     guidance, test file structure template, tolerance helpers, discrepancy
#     documentation format, agent session control rules
#   - Epic 5H status: in-progress (first story ready-for-dev)
#   - Next action: Dev Story (DS) for 5H.1 implementation
# 2026-02-20: Story 10.1 context document created (Create Story workflow)
#   - Full story file: 10-1-sensitivity-controls-sandbox-engine.md (ready-for-dev)
#   - 5 acceptance criteria blocks covering: "Scenarios" nav entry, sensitivity controls panel
#     (5 sliders with ranges), three-scenario computation (base/conservative/optimistic),
#     slider debounce and real-time dollar impact, and sandbox invariant (no plan mutation)
#   - Dev notes include: WorkspaceViewContext "scenarios" view pattern (no new URL route),
#     sensitivity-engine.ts design (extends scenario-engine.ts pattern), slider-to-EngineInput
#     field mapping (revenue multiplier, COGS additive PP, labor/marketing/facilities
#     multiplicative), dollar impact calculation, usePlan() data flow, anti-patterns
#     (no PATCH, no URL route, no scenario-engine.ts reuse, max 3 engine calls)
#   - Epic 10 status: in-progress (first story ready-for-dev)
# 2026-02-20: Story 5H.1 adversarial code review completed (full BMAD CR workflow)
#   - Step 1: Git change discovery — 4 source files changed, 1 undocumented (plan-initialization.test.ts) added to File List
#   - Step 3: Adversarial review — 8 findings (3 HIGH, 2 MEDIUM, 3 LOW), all resolved:
#     H2: CF validation expanded (depreciation/capex cross-checks, downstream divergence docs)
#     H3: BS full line-item comparison with quantified divergences (<10% WC, <20% RE)
#     M1: field-help.ts added to File List; M2: structured discrepancy docs (cell refs, deltas)
#     L1: tautological test removed; L2: intermediate month spot-checks (AC-7); L3: confirmed clean
#   - Step 3.5: LSP diagnostics — 0 errors/0 warnings on all 4 changed files
#   - Step 3.5: Architect deep analysis — concerns addressed (full file coverage verified)
#   - Step 5: Story status → done, sprint-status.yaml synced
#   - Final test count: 99 reference + 173 internal + 127 plan-init = 399/399 passing
#   - Story status: done
#   - Next action: Story 5H.2 (Report Tab UI Audit)
# 2026-02-20: Story 5H.2 Phase 1 & 2 completed (documentation-only workflow)
#   - Phase 1: Systematic visual audit of all 7 report tabs via code review
#   - Phase 2: Issue documentation with 7 issues identified:
#     UI-01 CRITICAL: Duplicate callout bars on 5/7 tabs (P&L, BS, CF, ROIC, Valuation)
#       — each tab renders its own callout bar overlapping parent CalloutBar's tab-specific content
#     UI-02 HIGH: BS identity check status (Balanced/Imbalanced) unique to BsCalloutBar — preserve during consolidation
#     UI-03 HIGH: Comparison mode column headers cramped at 15 data columns (Screenshot 3)
#     UI-04 MEDIUM: Sidebar z-index layering at overlay viewport widths (Screenshot 2)
#     UI-05 MEDIUM: Inconsistent callout bar styling (bg-background/95 vs bg-muted/30)
#     UI-06 LOW: ValCalloutBar unique "Net After-Tax Proceeds" metric — consider for consolidation
#     UI-07 LOW: Dark mode callout bar styling — Phase 2 post-MVP
#   - Phase 3 remediation plan PO-approved: consolidate all per-tab callout bars into parent CalloutBar
#   - Story document: 5h-2-report-tab-ui-audit-remediation.md (Phases 1-2 complete, 3-4 pending)
#   - Next action: Phase 3 remediation implementation (separate dev session)
# 2026-02-20: Story 10.2 context document created (Create Story workflow)
#   - Full story file: 10-2-multi-chart-sensitivity-dashboard.md (ready-for-dev)
#   - 11 acceptance criteria covering: 6 simultaneous charts (Profitability, Cash Flow,
#     Break-Even, ROI, Balance Sheet, Debt & Working Capital), slider reactivity,
#     4th "current" engine call, delta metric card indicators, chart color tokens,
#     amber advisory zones, sandbox invariant
#   - Dev notes include: 4-engine-call model (extends Story 10-1's 3-call limit),
#     Recharts + ChartContainer pattern, useMemo for chart data transforms,
#     EngineOutput field mappings per chart, scenario line styles (solid/dashed),
#     responsive 2-column grid layout, data-testid convention
#   - Story 10-2 depends on Story 10-1 implementation (sensitivity-engine.ts,
#     what-if-playground.tsx)
# 2026-02-20: Story 5H.2 context document created (Create Story workflow)
#   - Full story file rewritten from template: 5h-2-report-tab-ui-audit-remediation.md (ready-for-dev)
#   - 9 acceptance criteria covering: duplicate callout bar removal (AC-1), BS identity check
#     preservation (AC-2), Valuation Net After-Tax Proceeds (AC-3), comparison mode CalloutBar
#     visibility (AC-4), comparison column layout (AC-5), sidebar z-index (AC-6),
#     all-tab consistency (AC-7), no regressions (AC-8), Playwright verification (AC-9)
#   - Dev notes include: rendering stack diagram, UX spec callout bar table, anti-patterns
#     (no new per-tab callout bars), gotchas (2 unique content items to preserve, comparison
#     mode CalloutBar hidden condition, 2 call sites per tab), file change summary (8 files),
#     agent session control rules (carried from 5H.1)
#   - Phases 1-2 audit findings preserved as architectural context in dev notes
#   - Story status: ready-for-dev
#   - Next action: dev-story implementation (fresh context recommended)
# 2026-02-20: Story 5H.2 dev-story implementation verified & documented
#   - Implementation completed in prior session; this session executed BMAD dev-story workflow Steps 5-11
#   - All 7 acceptance criteria verified:
#     AC-1: No duplicate callout bars (count=1 on all 7 tabs) — Playwright PASS
#     AC-2: BS identity check preserved (Balanced/Imbalanced with icons) — Playwright PASS
#     AC-3: Valuation net proceeds preserved ($, data-testid) — Playwright PASS
#     AC-4: CalloutBar visible in comparison mode — Playwright PASS
#     AC-5: Column layout at 1024px (label column 200→180px) — Code verified
#     AC-6: No regressions (tab switching, rendering stability) — Playwright PASS
#     AC-7: Playwright e2e test suite passed (all assertions)
#   - 8 files modified: callout-bar.tsx, financial-statements.tsx, pnl-tab.tsx,
#     balance-sheet-tab.tsx, cash-flow-tab.tsx, roic-tab.tsx, valuation-tab.tsx,
#     comparison-table-head.tsx
#   - LSP diagnostics: 0 errors, 0 warnings across all 8 files
#   - Dev Agent Record completed in story file
#   - Story status: review (pending adversarial code review per Agent Session Control Rule #5)
#   - Next action: adversarial code review (fresh agent context recommended)
# 2026-02-21: Story 5H.3 context document created (Create Story workflow)
#   - Full story file: 5h-3-epic-6-ac-audit-user-journeys.md (ready-for-dev)
#   - 6 acceptance criteria covering: journey-to-story mapping (AC-1), gap analysis with
#     11 specific checks (AC-2), AC amendment proposals (AC-3), Story 5.9 handoff
#     verification (AC-4), completeness threshold consistency (AC-5), output format (AC-6)
#   - Dev notes include: artifact locations with line numbers, mapping table format,
#     gap classification scheme, amendment proposal template, 7 anti-patterns,
#     8 gotchas (including known completeness threshold inconsistency), agent session
#     control rules (carried from 5H.1/5H.2)
#   - Documentation-only story — no application source code changes
#   - Story status: ready-for-dev
#   - Next action: Dev Story (DS) for 5H.3 audit execution
# 2026-02-21: Story 5H.3 audit executed (Dev Story workflow)
#   - 9 journey steps mapped across Journeys 1, 2, 3, 5
#   - 8 gaps identified: GAP-01 (DRAFT threshold mismatch), GAP-02 (missing middle
#     tier), GAP-03 (subjective formatting), GAP-04 (no journey for doc history),
#     GAP-05 (no error state ACs), GAP-06 (thumbnail underspecified), GAP-07 (missing
#     IStorage immutability reference), GAP-08 (missing Audit section in PDF)
#   - 6 AC amendment proposals: threshold reconciliation, error states, measurable
#     formatting, audit section, thumbnail/immutability dev notes, doc history guidance
#   - Completeness threshold: two-surface model recommended (preview widget < 90%,
#     generated PDF three-tier < 50% / 50-90% / > 90%)
#   - Story 5.9 handoff: all 3 entry points aligned
#   - Story status: review (pending PO review of amendment proposals)
# 2026-02-21: Story 5H.2 adversarial code review completed (full BMAD CR workflow)
#   - Step 1: Git discovery — 8 source files + 1 undocumented test file; 2 discrepancies (test file + test summary not in File List)
#   - Step 3: Adversarial review — 4 findings (1 HIGH, 2 MEDIUM, 1 LOW), all resolved:
#     H1: BS identity check name mismatch in callout-bar.tsx — search predicate "balance sheet" didn't match engine's "BS identity" names. Always showed "Balanced". Fixed with filter()+every() on "bs identity".
#     M1: e2e test file added to story File List (was undocumented)
#     M2: Dev agent AC-2 evidence was invalid — Playwright test passed vacuously due to H1 bug (documented as noted finding)
#     L1: Unused useMemo import removed from roic-tab.tsx; unused ArrowDown import removed from balance-sheet-tab.tsx
#   - Step 4: LSP diagnostics — 0 errors, 0 warnings. Architect review completed.
#   - Step 5: All findings fixed. Story status → done, sprint-status.yaml synced.
#   - All 7 ACs verified SATISFIED (AC-2 required H1 fix to become truly functional)
#   - Next action: Story 5H.3 (Epic 6 AC Audit & User Journeys)
# 2026-02-21: Story 7.1 split into 7.1a–7.1d (Party Mode review + story grooming)
#   - Party Mode multi-agent review (Bob, Winston, Amelia, Quinn) identified 9 issues:
#     Scope (INVEST violation — 8 deliverables), Facilities dual-source-of-truth,
#     fragile inheritance heuristic, missing migration transactional safety,
#     otherOpexPct sanity cap, unresolved scenario engine question,
#     PerYearEditableRow composition pattern, 5 missing test scenarios
#   - Story 7.1 → 7.1a: Data Model Restructuring & Migration (AC-1, AC-2, AC-7 + fixes)
#   - New 7.1b: Reports Per-Year Inline Editing (AC-3)
#   - New 7.1c: Forms Mode Per-Year Layout (AC-4, inheritance simplified to independent fields)
#   - New 7.1d: New Field Surfaces (AC-5/6/8/9, Facilities source-of-truth resolved)
#   - Dependency chain: 7.1a → 7.1b + 7.1c (parallel) → 7.1d
#   - Epics.md updated: Epic 7 story count 2 → 5
#   - No Course Correct needed — story-level grooming, not strategic pivot
#   - See story files: 7-1-per-year-input-columns.md (now 7.1a),
#     7-1b-reports-per-year-editing.md, 7-1c-forms-per-year-layout.md,
#     7-1d-new-field-surfaces.md
# 2026-02-21: Story 7.1 context document created (Create Story workflow)
#   - Full story file: 7-1-per-year-input-columns.md (ready-for-dev)
#   - 7 acceptance criteria covering: PlanFinancialInputs per-year restructuring (AC-1),
#     lossless migration (AC-2), Reports independent per-year editing (AC-3),
#     Forms mode 5-column per-year layout (AC-4), Facilities field alignment (AC-5),
#     Other OpEx unit correction (AC-6), unwrapForEngine translation update (AC-7)
#   - Dev notes include: FinancialFieldValue array pattern, fill5() removal audit,
#     otherMonthly→otherOpexPct conversion elimination, facilities compound calculation
#     removal, year1GrowthRate/year2GrowthRate consolidation, migration idempotency,
#     scenario/sensitivity engine compatibility, 16 files in change summary
#   - Anti-patterns: no engine computation changes, no new API endpoints, no fill5
#     for per-year fields, no duplicate InlineEditableCell
#   - Epic 7 status: in-progress (first story ready-for-dev)
#   - Next action: Dev Story (DS) for 7.1 implementation
# 2026-02-21: Story 5H.4 context document created (Create Story workflow)
#   - Full story file: 5h-4-planning-artifact-alignment.md (ready-for-dev)
#   - 5 acceptance criteria across 5 phases: FR-to-Story Cross-Reference (111 FRs),
#     Story-to-FR Reverse Trace (57 stories across 14 epics), Coverage Map Correction
#     (96/96 → 111/111 header fix), Architecture Document Alignment (FR count, stale
#     mode references, editable-cell.tsx [DELETED] marker), Deliverable Summary
#   - Dev notes include: exact line numbers for all corrections, FR counting methodology,
#     mode vs tier distinction (tiers VALID, modes STALE), architecture category table
#     gap (Admin Support Tools FR59-FR73 missing), agent session control rules (carried
#     from 5H.1/5H.2/5H.3)
#   - Documentation-only story — no application source code changes
#   - Edits epics.md (coverage map) and architecture.md (FR count, stale references)
#   - Story status: ready-for-dev
#   - Next action: Dev Story (DS) for 5H.4 audit execution
# 2026-02-21: Epic 5H Retrospective FINALIZED (full 15-step BMAD workflow)
#   - All 15 retrospective steps executed in sequence
#   - Visual verification performed: ScenarioBar CONFIRMED visible, labor efficiency rows
#     NOT FOUND in DOM, callout bar remediation CONFIRMED working
#   - PO feedback captured verbatim: NOT SATISFIED with Epic 5H
#   - Key concerns: display format validation gap, 30-day month architecture decision
#     unmade, Plan CRUD (Epic 7) and Brand CRUD (Epic 2) flows unresolved,
#     forward momentum stalled by hardening work
#   - 9 action items: 2 CRITICAL (display format validation, 30-day month resolution),
#     3 HIGH (ScenarioBar removal, labor efficiency fix, 5H.3 AC amendments),
#     2 MEDIUM (decision surfacing process, display-layer validation standard),
#     2 LOW (content authoring, large file doc — carried from Epic 5)
#   - Critical path: 5 items must complete before Epic 6 implementation
#   - Deployment status: development only — not published
#   - Epic 5H status: DONE (all 4 stories + retrospective complete)
#   - See: epic-5h-retrospective.md
# 2026-02-21: Epic 5H Retro Action Items — HIGH items executed, then CRITICAL ENGINE BUGS FOUND
#   - AI-3 HIGH (ScenarioBar removal): DONE — ScenarioBar import and render removed from
#     financial-statements.tsx. "Compare Scenarios" button no longer visible in Reports.
#   - AI-4 HIGH (Labor Efficiency fix): ESCALATED TO CRITICAL — During AI-4 execution,
#     discovered the engine formula was COMPLETELY INVERTED (totalWages/revenue instead of
#     nonLaborGrossMargin/totalWages). This was NOT a tooltip issue — the engine computation
#     itself was wrong. Produced 0.17x instead of correct 3.71x. Fixed in financial-engine.ts.
#   - AI-5 HIGH (5H.3 AC amendments): DONE — all 6 amendments applied to epics.md.
#   - AI-1 CRITICAL (Display format validation): DEFERRED — PO decision to address after
#     progressing through several more epics.
#   - AI-2 CRITICAL (30-day month resolution): DEFERRED — PO decision to address after
#     progressing through several more epics.
#
# 2026-02-21: POST-RETROSPECTIVE ENGINE BUG DISCOVERY (PO-directed post-mortem)
#   *** THIS ENTRY CORRECTS THE RECORD — Story 5H.1 was NOT complete at time of retrospective ***
#   During AI-3/AI-4/AI-5 action item execution, 4 CRITICAL engine formula bugs were found
#   that Story 5H.1 ("cell-by-cell validation") was specifically designed to catch:
#
#   BUG 1: Labor Efficiency formula INVERTED
#     Engine had: totalWages / revenue (= 0.17x)
#     Reference spreadsheet: nonLaborGrossMargin / totalWages (= 3.71x)
#     The formula was computing the RECIPROCAL. Not a rounding error — completely backwards.
#     Root cause: 5H.1 tests covered P&L dollar values but NEVER tested P&L Analysis ratios.
#
#   BUG 2: ROIC percentage using after-tax instead of pre-tax
#     Engine had: afterTaxNetIncome / totalInvestedCapital
#     Reference (ROIC tab row 19): preTaxNetIncomeIncSweatEquity / totalInvestedCapital
#     Root cause: 5H.1 tests validated ROIC dollar components but NEVER validated roicPct itself.
#
#   BUG 3: Salary adjustment sign error (ROIC + P&L Analysis)
#     Engine had: preTaxNetIncome + annualSalaryAdj (should be minus)
#     Reference: Pre-Tax NI (-$92k) - Salary Adj ($55k) = -$147k
#     Root cause: Valuation section already had correct sign (subtraction). Nobody cross-checked.
#
#   BUG 4: businessAnnualROIC not synced from ROIC tab
#     Engine had: independent computation (adjNetOperatingIncome / equityAmount)
#     Reference: copies value directly from ROIC tab
#     Root cause: No cross-section consistency test existed.
#
#   BONUS: Runtime crash in pnl-tab.tsx interpretation function
#     Accessed enriched[0].laborEfficiency but field only exists on PLAnalysisOutput.
#     Crashed every time P&L Analysis section was expanded. Went undetected because section
#     was collapsed by default and nobody expanded it during testing or retrospective.
#
#   ALL FIXES APPLIED 2026-02-21:
#     - financial-engine.ts: 4 formula corrections
#     - pnl-tab.tsx: interpretation function data source fix
#     - financial-engine-reference.test.ts: 5 new tests (104 total, all passing)
#     - E2E verified: ROIC, Labor Efficiency, Business Annual ROIC all rendering correctly
#
#   PROCESS FAILURE ANALYSIS:
#     - Dev agent wrote tests covering dollar values, skipped ratios/percentages/cross-sections
#     - Code reviewer accepted "99 tests" without checking coverage against AC scope
#     - SM (Bob) accepted story as "done" without verifying test matrix against ACs
#     - Retrospective characterized engine bugs as "display issues" (understated severity)
#     - See: epic-5h-retrospective.md POST-RETROSPECTIVE ADDENDUM for full accountability

development_status:
  # Epic 1: Auth, Onboarding & User Management
  epic-1: done
  1-1-project-initialization-auth-database-schema: done
  1-2-invitation-creation-by-admin: done
  1-3-invitation-acceptance-account-creation: done
  1-4-login-logout-session-management: done
  1-5-role-based-access-control-middleware: done
  1-6-franchisee-onboarding-tier-recommendation: done
  epic-1-retrospective: done

  # Epic 2: Brand Configuration & Administration
  # Note: Story 2.5 (Brand Configuration Validation) relocated to Epic 3 as Story 3.7
  # due to dependency on financial engine. Epic 2 closes with 4/4 stories.
  epic-2: done
  2-1-brand-entity-financial-parameter-configuration: done
  2-2-startup-cost-template-management: done
  2-3-brand-identity-dynamic-theming: done
  2-4-account-manager-assignment: done
  epic-2-retrospective: done

  # Epic 3: Financial Planning Engine
  epic-3: done
  3-1-financial-engine-core-plan-schema: done
  3-2-brand-default-integration-per-field-metadata: done
  3-3-startup-cost-computation-custom-line-items: done
  3-4-live-summary-metrics-accounting-validation: done
  3-5-financial-input-api-per-field-reset: done
  3-6-quick-roi-first-90-second-experience: done
  3-7-brand-configuration-validation: done
  epic-3-retrospective: done

  # Epic 4: Forms Experience & Planning Infrastructure (renamed from "Forms & Quick Entry Experience")
  # Story 4.7 added mid-epic to close integration gaps
  # Stories 4.3/4.4 (Quick Entry) superseded — functionality absorbed by Reports inline editing (Epic 5)
  epic-4: done
  4-1-planning-layout-dashboard-mode-switcher: done
  4-2-forms-mode-section-based-input: done
  4-3-quick-entry-mode-grid-foundation: done
  4-4-quick-entry-mode-keyboard-navigation-formatting: done
  4-5-auto-save-session-recovery: done
  4-6-consultant-booking-link-workspace-chrome: done
  4-7-integration-gaps-startup-cost-mounting: done
  epic-4-retrospective: done

  # ==========================================================================
  # NEW EPICS (added via Sprint Change Proposal 2026-02-15)
  # ==========================================================================

  # Epic 5: Financial Statement Views & Output Layer [NEW]
  # Two interaction surfaces (My Plan + Reports) over shared financial input state
  # Dependencies: Epic 3 (engine), Epic 4 (planning workspace)
  # Pre-req: CP-2 engine extension (Story 5.1), CP-8 tech debt resolution
  # UX design authority: ux-design-specification-consolidated.md (2026-02-18)
  # FRs: FR7a-FR7m, FR84-FR97 (updated per SCP-2026-02-20 document remediation)
  # Stories: 9 (Story 5.7 RETIRED → Epic 10)
  # All 9 stories done + CP-11 confirmed. Epic 5 COMPLETE.
  # CODE REVIEW GAP (CRITICAL — flagged by Product Owner):
  # Only 5.1, 5.2, 5.3, 5.5 had formal adversarial code reviews.
  # Stories 5.4, 5.6, 5.8, 5.9, 5.10 were NEVER formally code-reviewed.
  # CP-7 re-verified ACs for 5.6-5.10 but did NOT run adversarial code review.
  # ADDITIONALLY: The 4 reviewed stories (5.1-5.3, 5.5) were reviewed BEFORE
  # SCP-2026-02-20 remediation edits (CP-1 through CP-13) modified their code.
  # Post-remediation code has NOT been reviewed by any formal process.
  # Net result: NO story in Epic 5 has a code review reflecting current code state.
  # Retrospective MUST assess whether full code reviews are needed before next epic.
  epic-5: done
  5-1-financial-engine-extension: done
  5-2-financial-statements-container-summary-tab: done
  5-3-pl-statement-tab: done
  5-4-balance-sheet-cash-flow-tabs: done
  5-5-roic-valuation-audit-tabs: done
  5-6-my-plan-impact-strip-bidirectional-data-flow: done
  5-7-scenario-comparison: done  # RETIRED per D6 — scope moves to Epic 10
  5-8-guardian-bar-dynamic-interpretation: done
  5-9-document-preview-pdf-generation-trigger: done
  5-10-glossary-contextual-help: done
  5-cp11-border-radius-polish: done  # SCP-2026-02-20 CP-11 — confirmed already applied
  epic-5-retrospective: done  # FINALIZED 2026-02-20 — action items (AI-1 through AI-10) captured for Sprint Planning

  # Epic 5H: Post-Epic-5 Hardening Sprint [NEW — from Epic 5 Retrospective]
  # Validation & remediation work gating Epic 6. Origin: AI-1, AI-2, AI-3, AI-5.
  # Must complete ALL 4 stories before Epic 6 implementation begins.
  # AI-7 (content authoring) → dev note on 6.1
  # AI-8 (dead code cleanup) → pre-Epic-6 checklist item
  # AI-9 (large file decision) → architecture note during Epic 6 planning
  # AI-10 (taxRate TODO) → absorbed into 5H.1 engine validation
  epic-5h: done
  5h-1-financial-engine-reference-validation: done  # AI-1: cell-by-cell vs reference spreadsheets. CORRECTED RECORD: Initially closed with 99 tests covering dollar values only. Post-retro audit found 4 CRITICAL engine bugs (inverted labor efficiency, after-tax ROIC, salary adj sign, ROIC sync) because tests skipped ratios/percentages/cross-sections. Fixed 2026-02-21, now 104 tests including ratio/pct coverage. See retrospective addendum.
  5h-2-report-tab-ui-audit-remediation: done    # AI-2: Implementation complete. 5 per-tab callout bars removed, parent CalloutBar enriched (BS identity check + Valuation net proceeds), comparison mode visibility fixed, column width reduced. Adversarial code review completed 2026-02-21 (H1 BS identity fix, all findings resolved).
  5h-3-epic-6-ac-audit-user-journeys: done              # AI-3: Audit executed. 8 gaps found (3 Blocker, 3 Quality Risk, 2 Enhancement). 6 AC amendment proposals. Completeness threshold 2-surface model recommended. PO review completed 2026-02-21.
  5h-4-planning-artifact-alignment: done                  # AI-5: 111 FR traceability, fix stale coverage map. Audit complete: 111/111 FRs mapped, 54 stories traced, 6 artifact corrections applied. PO review completed 2026-02-21.
  epic-5h-retrospective: done  # FINALIZED 2026-02-21 — 15-step workflow completed. 9 action items (2 CRITICAL, 3 HIGH, 2 MEDIUM, 2 LOW). 5 critical path blockers before Epic 6. PO NOT SATISFIED. See: epic-5h-retrospective.md

  # Epic 6: Document Generation & Vault [ELEVATED from old Epic 7]
  # PDF export + document history
  # Dependencies: Epic 5 (statement views must exist to export), Epic 5H (hardening must complete first)
  epic-6: backlog
  6-1-pdf-document-generation: backlog
  6-2-document-history-downloads: backlog
  epic-6-retrospective: optional

  # Epic 7: Per-Year Inputs & Multi-Plan Management [NEW]
  # Year 1-5 input columns + plan CRUD
  # Dependencies: Epic 5 (linked-column indicators provide visual foundation)
  # Story 7.1 split into 7.1a–7.1d per Party Mode review (2026-02-21)
  # Dependency chain: 7.1a → 7.1b + 7.1c (parallel) → 7.1d
  epic-7: in-progress
  7-1a-data-model-restructuring-migration: ready-for-dev      # Foundation: PlanFinancialInputs per-year arrays, migration, unwrapForEngine, field metadata, sensitivity/scenario engines
  7-1b-reports-per-year-inline-editing: backlog                # Depends on 7.1a. Reports independent editing, linked-column removal, Copy Year 1, PerYearEditableRow
  7-1c-forms-per-year-layout: backlog                          # Depends on 7.1a. Can parallel with 7.1b. Forms 5-column layout, new field sections
  7-1d-new-field-surfaces: backlog                             # Depends on 7.1a + 7.1b + 7.1c. Facilities decomposition, Other OpEx %, Balance Sheet/Valuation editing
  7-2-plan-crud-navigation: backlog
  epic-7-retrospective: optional

  # ==========================================================================
  # RENUMBERED EPICS (from Sprint Change Proposal 2026-02-15)
  # ==========================================================================

  # Epic 8: Advisory Guardrails & Smart Guidance [was Epic 5]
  epic-8: backlog
  8-1-input-range-validation-advisory-nudges: backlog
  8-2-weak-business-case-detection-actionable-guidance: backlog
  epic-8-retrospective: optional

  # Epic 9: AI Planning Advisor (Planning Assistant) [was Epic 6]
  epic-9: backlog
  9-1-llm-integration-conversation-api: backlog
  9-2-split-screen-planning-assistant-interface: backlog
  9-3-ai-value-extraction-field-population: backlog
  9-4-graceful-degradation-mode-continuity: backlog
  epic-9-retrospective: optional

  # Epic 10: What-If Playground — User-Authored Scenario Modeling [was Scenario Comparison, part of old Epic 7]
  # Rewritten per SCP-2026-02-20 D5/D6 — standalone sensitivity dashboard, not column-splitting
  # Pivoted per SCP-2026-02-21 — user-authored scenarios replace system-defined Conservative/Optimistic
  # Stories (4): Sensitivity Controls, Chart Dashboard, Metric Delta Cards, Scenario Persistence & Comparison
  epic-10: in-progress
  10-1-sensitivity-controls-sandbox-engine: needs-revision  # AC rewrite + code modification per SCP-2026-02-21 CP-2/CP-7/CP-8
  10-2a-sensitivity-chart-dashboard: needs-revision  # AC rewrite per SCP-2026-02-21 CP-3 (split from 10-2)
  10-2b-metric-delta-cards: needs-revision  # AC rewrite per SCP-2026-02-21 CP-4 (split from 10-2)
  10-3-scenario-persistence-comparison: ready-for-dev  # Promoted from optional to essential per SCP-2026-02-21 CP-5
  epic-10-retrospective: optional

  # Epic ST: Admin Support Tools — Impersonation & Demo Modes
  # Added via Sprint Change Proposal 2026-02-11
  epic-st: in-progress
  st-1-view-as-infrastructure-read-only-mode: done
  st-2-view-as-edit-mode-audit-logging: done
  st-3-franchisee-demo-mode-per-brand: done
  st-4-franchisor-demo-mode-fictitious-brand: backlog  # blocked: depends on Epic 11 franchisor dashboard
  epic-st-retrospective: optional

  # Epic 11: Data Sharing, Privacy & Pipeline Dashboards [was Epic 8]
  epic-11: backlog
  11-1-franchisee-data-sharing-controls: backlog
  11-2-franchisor-pipeline-dashboard: backlog
  11-3-katalyst-admin-cross-brand-dashboard: backlog
  epic-11-retrospective: optional

  # Epic 12: Advisory Board Meeting (Phase 2 — Deferred) [was Epic 9]
  epic-12: backlog
  epic-12-retrospective: optional
