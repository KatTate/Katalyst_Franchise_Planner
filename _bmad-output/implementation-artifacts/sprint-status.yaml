# generated: 2026-02-09
# updated: 2026-02-20 (Sprint Planning regenerated: Epic 5H Create Epics workflow complete)
# project: Katalyst Growth Planner
# project_key: NOKEY
# tracking_system: file-system
# story_location: _bmad-output/implementation-artifacts

# STATUS DEFINITIONS:
# ==================
# Epic Status:
#   - backlog: Epic not yet started
#   - in-progress: Epic actively being worked on
#   - done: All stories in epic completed
#
# Epic Status Transitions:
#   - backlog → in-progress: Automatically when first story is created (via create-story)
#   - in-progress → done: Manually when all stories reach 'done' status
#
# Story Status:
#   - backlog: Story only exists in epic file
#   - ready-for-dev: Story file created in stories folder
#   - in-progress: Developer actively working on implementation
#   - review: Ready for code review (via Dev's code-review workflow)
#   - done: Story completed
#
# Retrospective Status:
#   - optional: Can be completed but not required
#   - done: Retrospective has been completed
#
# WORKFLOW NOTES:
# ===============
# - Epic transitions to 'in-progress' automatically when first story is created
# - Stories can be worked in parallel if team capacity allows
# - SM typically creates next story after previous one is 'done' to incorporate learnings
# - Dev moves story to 'review', then runs code-review (fresh context, different LLM recommended)

generated: 2026-02-09
updated: 2026-02-20
project: Katalyst Growth Planner
project_key: NOKEY
tracking_system: file-system
story_location: _bmad-output/implementation-artifacts

# CHANGE LOG:
# ===========
# 2026-02-15: Sprint Change Proposal approved — Financial Statement Output Layer
#   - New Epic 5: Financial Statement Views & Output Layer (10 stories)
#   - New Epic 6: Document Generation & Vault (2 stories, elevated from old Epic 7)
#   - New Epic 7: Per-Year Inputs & Multi-Plan Management (2 stories)
#   - Old Epic 5 (Advisory Guardrails) renumbered to Epic 8
#   - Old Epic 6 (AI Planning Advisor) renumbered to Epic 9
#   - Old Epic 7 (Scenario & Docs) split: PDF→Epic 6, Scenario→Epic 10
#   - Old Epic 8 (Data Sharing) renumbered to Epic 11
#   - Old Epic 9 (Advisory Board) renumbered to Epic 12
#   - Pre-implementation: resolve carried tech debt (CP-8)
#   - See: sprint-change-proposal-2026-02-15.md
# 2026-02-16: Correct Course handoff actions completed
#   - PRD updated with FR7a-FR7n (14 new functional requirements)
#   - epics.md restructured: new Epics 5-7, renumbered 8-12, Epic 5/7 story placeholders
#   - architecture.md updated: brand_account_managers table, engine extension design,
#     financial statement API endpoints, help content data model
#   - CP-8 tech debt: invitations.ts as-any replaced with typed InsertUser cast;
#     storage.ts as-any retained (drizzle-zod type compatibility — documented)
#   - UX design authority created: ux-financial-statements-spec.md (1,067 lines)
# 2026-02-16: Sprint Planning regenerated
#   - Epic 5 story keys corrected to match epics.md story titles
#     (was: 5-1-pl-statement-view etc.; now: 5-1-financial-engine-extension etc.)
#   - All story counts verified: 52 stories across 13 epics
#   - All statuses preserved — no downgrades
# 2026-02-16: Story 5.1 adversarial code review completed
#   - 0 HIGH, 3 MEDIUM, 3 LOW findings — all resolved
#   - Math.max(0) guard added for adjustedTotalWages, docstrings updated
#   - architecture.md synced (cfOtherAssetsChange → cfDepreciation)
#   - 173 tests passing (49 existing + 124 new), zero regressions
#   - Story status confirmed: done
# 2026-02-17: Story 5.2 adversarial code review completed
#   - 2 HIGH, 3 MEDIUM, 2 LOW findings — all resolved
#   - H1/H2: getQuarterlyValue percentage averaging fix (was summing → 3x values)
#   - M1: ExperienceTier type moved out of retired mode-switcher.tsx
#   - L1: hover:bg-muted/30 → hover-elevate; L2: as-any cast → EnrichedAnnualSummary type
#   - M2/M3: analysis-only (sub-sections and ColumnHeaders are intentional design)
#   - LSP clean, story status: done
# 2026-02-17: Story 5.3 adversarial code review completed
#   - 0 HIGH, 3 MEDIUM, 3 LOW findings — all resolved
#   - M1: Math.abs() added for expense row display (Dev Notes sign convention)
#   - M2: Section header sticky removed (z-index conflict with callout bar)
#   - M3: Section header keyboard accessibility (tabIndex, aria-expanded, onKeyDown)
#   - L1: EBITDA tooltip formula corrected; L2: dead code removed; L3: glossary link placeholder
#   - LSP clean, story status: done
# 2026-02-18: Story 5.4 completed (commit 99531198)
#   - Balance Sheet tab: verified and fixed cumulative depreciation calculation
#   - Cash Flow tab: new component with 4 sections, identity check, amber negative cash
#   - Container: BalanceSheetTab and CashFlowTab replace PlaceholderTab components
#   - 20/20 acceptance criteria verified against code, LSP clean
#   - Story status: done
# 2026-02-18: UX Design Specification consolidated
#   - Created ux-design-specification-consolidated.md as single source of truth
#   - Replaces ux-financial-statements-spec.md as UX design authority for all epics
#   - Establishes two-surface architecture (My Plan + Reports), retires three-mode model
#   - See: ux-design-specification-consolidated.md
# 2026-02-19: Story 5.5 adversarial code review completed
#   - 3 HIGH, 4 MEDIUM, 3 LOW findings — documented as review notes (not fixed)
#   - H1: Audit category names/count don't match AC14's 13 listed categories (engine produces 15)
#   - H2: Passing audit categories missing muted text styling (AC16)
#   - H3: Failing check detail missing per-row pass/fail icon (AC17)
#   - M1: tooltip.tsx modified (Dev Notes violation); M2: 6 undocumented file changes
#   - M3: Comparison mode missing keyboard accessibility; M4: unused useMemo import
#   - User chose option 2 (add review notes to story) — findings documented for dev agent
#   - Story status: in-progress (HIGH issues unresolved)
# 2026-02-18: Story 5.6 implementation completed (commit 4385698f, 6e33a51a)
#   - P&L inline editing: 5 editable rows (monthly-revenue, cogs-pct, dl-pct, marketing, other-opex)
#   - InlineEditableCell component: click-to-edit, Tab/Shift+Tab/Enter/Escape, flash animation
#   - Linked columns: all year columns update simultaneously with 200ms flash feedback
#   - Optimistic display: raw input values shown immediately from plan cache
#   - Double-commit guard (committedRef) prevents blur+Tab duplicate saves
#   - AC7 (EBITDA Multiple) deferred: ebitdaMultiple not in PlanFinancialInputs schema
#   - Playwright e2e tests passing, LSP clean
#   - Story status: review
# 2026-02-19: Sprint Change Proposal — UX Specification Compliance Remediation
#   - 13 divergences cataloged (3 Critical, 4 High, 4 Medium, 2 Low)
#   - 11 change proposals (CP-1 through CP-11) with execution sequence
#   - Adversarial review: 14 findings (2 CRITICAL, 4 HIGH, 4 MEDIUM, 2 LOW)
#   - Amendment A: Spec reconciliation — C1 reclassified as Category B (deprecate, don't delete)
#   - Amendment B: C-ratio display bug confirmed, formatted-output audit
#   - Selected approach: Option 1 (Direct Adjustment — patch forward)
#   - All divergences are UI-layer; engine/auth/API untouched
#   - See: sprint-change-proposal-2026-02-19.md
# 2026-02-20: PRD alignment edit completed
#   - PRD updated to align with two-surface UX architecture
#   - 24 new FRs added (FR74-FR97) covering Reports inline editing, two-surface model,
#     Impact Strip, Guardian Bar, Document Preview, plan completeness, glossary,
#     contextual help, behavioral tiers, and progressive disclosure
#   - FR12 rewritten: "two interaction surfaces" replaces "three experience tiers"
#   - Total PRD FRs: 111 (was 87)
# 2026-02-20: Implementation Readiness (IR) check completed
#   - 111 FRs traced, 30 NFRs validated, all substantively covered in story ACs
#   - 5 issues found: architecture.md still references "three modes" and retired components,
#     epics FR Coverage Map stale (claims 87/87, PRD has 111), environment gaps
#   - Overall status: NEEDS WORK (architecture doc + epics coverage map + remediation CPs)
#   - See: implementation-readiness-report-2026-02-20.md
# 2026-02-20: Sprint Planning regenerated
#   - Updated changelog with UX consolidation, SCP-2026-02-19, PRD edit, IR check
#   - All story counts verified: 52 stories across 13 epics (unchanged)
#   - All statuses preserved — no downgrades
#   - Next action: execute SCP-2026-02-19 remediation CPs to close Epic 5
# 2026-02-20: CP-6 executed — Story 5.5 HIGH findings resolved
#   - H1: Engine comment corrected (13→15 categories); CATEGORY_CONFIG verified correct (all 15 mapped)
#   - H2: Passing audit category labels now use text-muted-foreground (AC16 compliance)
#   - H3: Per-row pass/fail icons confirmed already present in AuditCheckRow component
#   - M4: useMemo import verified as used (finding was incorrect)
#   - Story 5.5 status: done
# 2026-02-20: CP-7 executed — Stories 5.6, 5.7, 5.8, 5.9, 5.10 re-verified
#   - Story 5.6 (My Plan + Impact Strip + Bidirectional Data Flow): PASS
#     InputPanel→FormsMode direct render (mode switcher removed per CP-1),
#     Impact Strip: sticky bottom bar, context-sensitive metrics, 3s delta fade,
#     guardian dots, deep links, doc preview icon, bidirectional P&L inline editing
#   - Story 5.7 (Scenario Comparison): RETIRED per Decision D6 in SCP-2026-02-20
#     ScenarioBar component retained; story scope moves to Epic 10 (What-If Playground)
#   - Story 5.8 (Guardian Bar & Dynamic Interpretation): PASS
#     3-level indicator system (healthy/attention/concerning), pulse animation on threshold
#     change, tab navigation on click, all-defaults note, sr-only accessibility text
#   - Story 5.9 (Document Preview & PDF Generation Trigger): PASS
#     Dashboard widget + modal preview, DRAFT watermark, PDF toast placeholder,
#     evolving button label (Generate Draft / Generate Package / Generate Lender Package),
#     Impact Strip doc preview icon, all-defaults note
#     Draft watermark threshold corrected: was <90%, now <50% per AC
#   - Story 5.10 (Glossary & Contextual Help): PASS
#     Searchable glossary page at /glossary/:slug, field help icons with tooltips,
#     expanded guidance, glossary cross-links, brand benchmarks, "See it in your plan",
#     sidebar navigation link
# 2026-02-20: SCP-2026-02-20 handoff — Correct Course Step 6 execution
#   - Codebase audit: 15/16 CPs confirmed done. Only CP-11 (border radius) incomplete.
#   - Document remediation executed (previously skipped during handoff):
#     a) architecture.md: FR count updated 87→96, 5 new FR categories added
#     b) epics.md: FR Coverage Map updated 87→96 (27 new FR mappings: FR74-FR97)
#     c) epics.md: Epic 10 rewritten — Story 10.1 decomposed into 3 stories
#        (10.1 Sensitivity Controls, 10.2 Multi-Chart Dashboard, 10.3 Scenario Persistence)
#        matching SCP Section 3 What-If Playground vision
#     d) epics.md: Quick Entry references updated (Epic 4 deprecation note, Epic 9 graceful
#        degradation, Story 8.1 advisory nudge) to reflect two-surface architecture
#     e) Epic 4 renamed: "Forms & Quick Entry Experience" → "Forms Experience & Planning Infrastructure"
#     f) Epic 5 FR coverage expanded to include FR84-FR97, story count corrected to 9
#   - Sprint status updated: Epic 10 stories reflect new 3-story structure
#   - CP-11 border radius polish: audit confirmed already applied (Card=rounded-2xl,
#     Button=rounded-xl, Input=rounded-xl). All 16/16 SCP items complete.
#   - Epic 5 marked DONE — all 9 stories + all SCP remediation CPs confirmed complete
# 2026-02-20: Epic 5 Retrospective — DRAFT (un-finalized)
#   - Product Owner assessment: "Dumpster fire shit show rodeo"
#   - Readiness assessment: RED (4 RED items: engine accuracy, code review, UI quality, agent control)
#   - 10 action items documented (3 CRITICAL, 3 HIGH, 3 MEDIUM, 1 carried)
#   - CRITICAL blocker: Financial engine never validated cell-by-cell against reference spreadsheets
#   - CRITICAL blocker: Code review coverage collapsed to 44%; no story has post-remediation review
#   - CRITICAL blocker: UI layout issues visible in Balance Sheet, sidebar overlap, comparison mode
#   - Agent control finding: Rogue agent approved own SCP amendments; process gap documented
#   - Draft status: Pending engine validation results before finalization
#   - See: epic-5-retrospective.md
# 2026-02-20: Sprint Planning regenerated (post-Create Epics workflow)
#   - Epic 5H: 4 stories formally created via full Create Epics 4-step workflow
#   - Party Mode review completed: 9 amendments applied to story ACs
#     (PO gates, prerequisite dependencies, Playwright verification, scope boundaries)
#   - All story counts verified: 57 stories across 14 epics
#   - 2 documented orphans preserved (4-7, 5-cp11) — historical implementation artifacts
#   - All statuses preserved — no downgrades
#   - Next action: Create Story (CS) for 5H.1 to begin hardening sprint

development_status:
  # Epic 1: Auth, Onboarding & User Management
  epic-1: done
  1-1-project-initialization-auth-database-schema: done
  1-2-invitation-creation-by-admin: done
  1-3-invitation-acceptance-account-creation: done
  1-4-login-logout-session-management: done
  1-5-role-based-access-control-middleware: done
  1-6-franchisee-onboarding-tier-recommendation: done
  epic-1-retrospective: done

  # Epic 2: Brand Configuration & Administration
  # Note: Story 2.5 (Brand Configuration Validation) relocated to Epic 3 as Story 3.7
  # due to dependency on financial engine. Epic 2 closes with 4/4 stories.
  epic-2: done
  2-1-brand-entity-financial-parameter-configuration: done
  2-2-startup-cost-template-management: done
  2-3-brand-identity-dynamic-theming: done
  2-4-account-manager-assignment: done
  epic-2-retrospective: done

  # Epic 3: Financial Planning Engine
  epic-3: done
  3-1-financial-engine-core-plan-schema: done
  3-2-brand-default-integration-per-field-metadata: done
  3-3-startup-cost-computation-custom-line-items: done
  3-4-live-summary-metrics-accounting-validation: done
  3-5-financial-input-api-per-field-reset: done
  3-6-quick-roi-first-90-second-experience: done
  3-7-brand-configuration-validation: done
  epic-3-retrospective: done

  # Epic 4: Forms Experience & Planning Infrastructure (renamed from "Forms & Quick Entry Experience")
  # Story 4.7 added mid-epic to close integration gaps
  # Stories 4.3/4.4 (Quick Entry) superseded — functionality absorbed by Reports inline editing (Epic 5)
  epic-4: done
  4-1-planning-layout-dashboard-mode-switcher: done
  4-2-forms-mode-section-based-input: done
  4-3-quick-entry-mode-grid-foundation: done
  4-4-quick-entry-mode-keyboard-navigation-formatting: done
  4-5-auto-save-session-recovery: done
  4-6-consultant-booking-link-workspace-chrome: done
  4-7-integration-gaps-startup-cost-mounting: done
  epic-4-retrospective: done

  # ==========================================================================
  # NEW EPICS (added via Sprint Change Proposal 2026-02-15)
  # ==========================================================================

  # Epic 5: Financial Statement Views & Output Layer [NEW]
  # Two interaction surfaces (My Plan + Reports) over shared financial input state
  # Dependencies: Epic 3 (engine), Epic 4 (planning workspace)
  # Pre-req: CP-2 engine extension (Story 5.1), CP-8 tech debt resolution
  # UX design authority: ux-design-specification-consolidated.md (2026-02-18)
  # FRs: FR7a-FR7m, FR84-FR97 (updated per SCP-2026-02-20 document remediation)
  # Stories: 9 (Story 5.7 RETIRED → Epic 10)
  # All 9 stories done + CP-11 confirmed. Epic 5 COMPLETE.
  # CODE REVIEW GAP (CRITICAL — flagged by Product Owner):
  # Only 5.1, 5.2, 5.3, 5.5 had formal adversarial code reviews.
  # Stories 5.4, 5.6, 5.8, 5.9, 5.10 were NEVER formally code-reviewed.
  # CP-7 re-verified ACs for 5.6-5.10 but did NOT run adversarial code review.
  # ADDITIONALLY: The 4 reviewed stories (5.1-5.3, 5.5) were reviewed BEFORE
  # SCP-2026-02-20 remediation edits (CP-1 through CP-13) modified their code.
  # Post-remediation code has NOT been reviewed by any formal process.
  # Net result: NO story in Epic 5 has a code review reflecting current code state.
  # Retrospective MUST assess whether full code reviews are needed before next epic.
  epic-5: done
  5-1-financial-engine-extension: done
  5-2-financial-statements-container-summary-tab: done
  5-3-pl-statement-tab: done
  5-4-balance-sheet-cash-flow-tabs: done
  5-5-roic-valuation-audit-tabs: done
  5-6-my-plan-impact-strip-bidirectional-data-flow: done
  5-7-scenario-comparison: done  # RETIRED per D6 — scope moves to Epic 10
  5-8-guardian-bar-dynamic-interpretation: done
  5-9-document-preview-pdf-generation-trigger: done
  5-10-glossary-contextual-help: done
  5-cp11-border-radius-polish: done  # SCP-2026-02-20 CP-11 — confirmed already applied
  epic-5-retrospective: done  # FINALIZED 2026-02-20 — action items (AI-1 through AI-10) captured for Sprint Planning

  # Epic 5H: Post-Epic-5 Hardening Sprint [NEW — from Epic 5 Retrospective]
  # Validation & remediation work gating Epic 6. Origin: AI-1, AI-2, AI-3, AI-5.
  # Must complete ALL 4 stories before Epic 6 implementation begins.
  # AI-7 (content authoring) → dev note on 6.1
  # AI-8 (dead code cleanup) → pre-Epic-6 checklist item
  # AI-9 (large file decision) → architecture note during Epic 6 planning
  # AI-10 (taxRate TODO) → absorbed into 5H.1 engine validation
  epic-5h: backlog
  5h-1-financial-engine-reference-validation: backlog  # AI-1: cell-by-cell vs reference spreadsheets (min 2 brands)
  5h-2-report-tab-ui-audit-remediation: backlog        # AI-2: ALL 7 report tabs, not just Balance Sheet
  5h-3-epic-6-ac-audit-user-journeys: backlog           # AI-3: Story ACs vs 8 user journeys, gap analysis
  5h-4-planning-artifact-alignment: backlog              # AI-5: 111 FR traceability, fix stale coverage map
  epic-5h-retrospective: optional

  # Epic 6: Document Generation & Vault [ELEVATED from old Epic 7]
  # PDF export + document history
  # Dependencies: Epic 5 (statement views must exist to export), Epic 5H (hardening must complete first)
  epic-6: backlog
  6-1-pdf-document-generation: backlog
  6-2-document-history-downloads: backlog
  epic-6-retrospective: optional

  # Epic 7: Per-Year Inputs & Multi-Plan Management [NEW]
  # Year 1-5 input columns + plan CRUD
  # Dependencies: Epic 5 (linked-column indicators provide visual foundation)
  epic-7: backlog
  7-1-per-year-input-columns: backlog
  7-2-plan-crud-navigation: backlog
  epic-7-retrospective: optional

  # ==========================================================================
  # RENUMBERED EPICS (from Sprint Change Proposal 2026-02-15)
  # ==========================================================================

  # Epic 8: Advisory Guardrails & Smart Guidance [was Epic 5]
  epic-8: backlog
  8-1-input-range-validation-advisory-nudges: backlog
  8-2-weak-business-case-detection-actionable-guidance: backlog
  epic-8-retrospective: optional

  # Epic 9: AI Planning Advisor (Planning Assistant) [was Epic 6]
  epic-9: backlog
  9-1-llm-integration-conversation-api: backlog
  9-2-split-screen-planning-assistant-interface: backlog
  9-3-ai-value-extraction-field-population: backlog
  9-4-graceful-degradation-mode-continuity: backlog
  epic-9-retrospective: optional

  # Epic 10: What-If Playground [was Scenario Comparison, part of old Epic 7]
  # Rewritten per SCP-2026-02-20 D5/D6 — standalone sensitivity dashboard, not column-splitting
  # Stories (3): Sensitivity Controls, Multi-Chart Dashboard, Scenario Persistence (optional)
  epic-10: backlog
  10-1-sensitivity-controls-sandbox-engine: backlog
  10-2-multi-chart-sensitivity-dashboard: backlog
  10-3-scenario-persistence-sharing: backlog  # optional enhancement
  epic-10-retrospective: optional

  # Epic ST: Admin Support Tools — Impersonation & Demo Modes
  # Added via Sprint Change Proposal 2026-02-11
  epic-st: in-progress
  st-1-view-as-infrastructure-read-only-mode: done
  st-2-view-as-edit-mode-audit-logging: done
  st-3-franchisee-demo-mode-per-brand: done
  st-4-franchisor-demo-mode-fictitious-brand: backlog  # blocked: depends on Epic 11 franchisor dashboard
  epic-st-retrospective: optional

  # Epic 11: Data Sharing, Privacy & Pipeline Dashboards [was Epic 8]
  epic-11: backlog
  11-1-franchisee-data-sharing-controls: backlog
  11-2-franchisor-pipeline-dashboard: backlog
  11-3-katalyst-admin-cross-brand-dashboard: backlog
  epic-11-retrospective: optional

  # Epic 12: Advisory Board Meeting (Phase 2 — Deferred) [was Epic 9]
  epic-12: backlog
  epic-12-retrospective: optional
